# 采样板构成

## 1 下位机

### 1.1 硬件与引脚

- TIM
    - TIM1
      - 1kHz定时器中断
    - TIM2
      - PB11, CH4, 10k的ARR, 绑定呼吸灯
- ADC
  - ADC1
    - PA2, IN3, 绑定电压采样
    - PB1, IN12, 绑定电流采样
- USART
  - USART1, 1Mbps, 9e1
    - PA9, TX
    - PA10, RX
- CAN, 1Mbps
    - PB8, RX
    - PB9, TX
- USB
    - PA11, DM
    - PA12, DP

## 1.2 协议

- USART与USB的通信协议

  | 字段 | Frame_Header   | Current        | Voltage        | Power        | Checksum                                                 |
  | ---- | :------------- | :------------- | :------------- | :----------- | :------------------------------------------------------- |
  | 长度 | 1B             | 4B             | 4B             | 4B           | 1B                                                       |
  | 说明 | 帧头，默认0xAB | 电流值，浮点数 | 电压值，浮点数 | 功率，浮点数 | 校验和，范围是前面的三个浮点数字段按字节求和，不考虑溢出 |

- CAN的通信协议

  | 字段 | Current        | Voltage        |
  | ---- | :------------- | :------------- |
  | 长度 | 4B             | 4B             |
  | 说明 | 电流值，浮点数 | 电压值，浮点数 |

## 2 上位机

- 制作中，打算可以实现下述功能
  - 用裁判系统或者电子负载标定电流电压功率等参数，并写到flash里
  - 配置相关滤波器系数，写道背板flash里
  - 配置反馈频率，或实现请求回复功能